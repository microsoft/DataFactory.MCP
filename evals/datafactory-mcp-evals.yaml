# Microsoft Data Factory MCP Server Evaluations
# This file contains evaluation tests for the DataFactory MCP server tools
# using the mcp-evals framework

# Model configuration
model:
  provider: openai # 'openai' or 'anthropic'
  name: gpt-4o # Model name
  # api_key: sk-...   # Optional, uses OPENAI_API_KEY env var by default

# List of evaluations to run
evals:
  # Authentication Tool Evaluations
  - name: auth_interactive_basic
    description: Test basic interactive authentication functionality
    prompt: "Authenticate with Azure AD using interactive login"
    expected_result: "Should initiate interactive authentication flow and return authentication status or success message"

  - name: auth_service_principal_valid
    description: Test service principal authentication with valid parameters
    prompt: "Authenticate using service principal with application ID 'test-app-id' and client secret 'test-secret'"
    expected_result: "Should authenticate with service principal and return success status"

  - name: auth_service_principal_missing_params
    description: Test service principal authentication with missing parameters
    prompt: "Authenticate using service principal without providing required parameters"
    expected_result: "Should return appropriate error message about missing required parameters (application ID or client secret)"

  - name: auth_status_check
    description: Test authentication status retrieval
    prompt: "Get the current authentication status"
    expected_result: "Should return current authentication state and user profile information"

  - name: auth_access_token
    description: Test access token retrieval
    prompt: "Get the current access token for the authenticated user"
    expected_result: "Should return valid access token or appropriate error if not authenticated"

  - name: auth_sign_out
    description: Test sign out functionality
    prompt: "Sign out the current user"
    expected_result: "Should clear authentication and return confirmation of successful sign out"

  # Workspace Management Evaluations
  - name: workspace_list_all
    description: Test listing all workspaces
    prompt: "List all workspaces the user has access to"
    expected_result: "Should return a list of workspaces with details like ID, name, and metadata"

  - name: workspace_list_filtered_by_role
    description: Test workspace filtering by user roles
    prompt: "List workspaces where I have Admin or Member roles"
    expected_result: "Should return filtered list of workspaces based on specified roles (Admin, Member)"

  - name: workspace_list_with_pagination
    description: Test workspace listing with pagination
    prompt: "List workspaces with pagination, get the first page"
    expected_result: "Should return paginated results with continuation token for next page if available"

  - name: workspace_list_no_access
    description: Test workspace listing when user has no access
    prompt: "List workspaces for a user with no permissions"
    expected_result: "Should handle gracefully and return appropriate message about no workspaces available"

  # Connection Management Evaluations
  - name: connection_list_all
    description: Test listing all connections
    prompt: "List all connections including on-premises, virtual network, and cloud connections"
    expected_result: "Should return comprehensive list of all connection types with their details"

  - name: connection_get_specific
    description: Test retrieving specific connection details
    prompt: "Get details for a specific connection by its ID"
    expected_result: "Should return detailed information about the specified connection including type, configuration, and status"

  - name: connection_list_with_pagination
    description: Test connection listing with pagination
    prompt: "List connections with pagination support"
    expected_result: "Should return paginated connection results with continuation token if more results available"

  - name: connection_not_found
    description: Test handling of non-existent connection requests
    prompt: "Get details for a connection that doesn't exist"
    expected_result: "Should return appropriate error message indicating connection was not found"

  # Gateway Management Evaluations
  - name: gateway_list_all_types
    description: Test listing all gateway types
    prompt: "List all gateways including on-premises, personal mode, and virtual network gateways"
    expected_result: "Should return list of all gateway types with their configurations and status"

  - name: gateway_get_specific
    description: Test retrieving specific gateway details
    prompt: "Get detailed information about a specific gateway by ID"
    expected_result: "Should return comprehensive gateway information including type, status, and configuration details"

  - name: gateway_list_with_pagination
    description: Test gateway listing with pagination
    prompt: "List gateways with pagination support"
    expected_result: "Should return paginated gateway results with continuation token for additional pages"

  - name: gateway_access_denied
    description: Test gateway access when user lacks permissions
    prompt: "List gateways for a user without gateway permissions"
    expected_result: "Should handle access denial gracefully with appropriate authentication or permission error message"

  # Dataflow Management Evaluations
  - name: dataflow_list_by_workspace
    description: Test listing dataflows for a specific workspace
    prompt: "List all dataflows in workspace ID 'sample-workspace-123'"
    expected_result: "Should return list of dataflows for the specified workspace with their details and metadata"

  - name: dataflow_list_empty_workspace
    description: Test listing dataflows for workspace with no dataflows
    prompt: "List dataflows for a workspace that contains no dataflows"
    expected_result: "Should return appropriate message indicating no dataflows found in the workspace"

  - name: dataflow_list_invalid_workspace
    description: Test listing dataflows with invalid workspace ID
    prompt: "List dataflows without providing a workspace ID or with invalid workspace ID"
    expected_result: "Should return error message indicating workspace ID is required or invalid"

  - name: dataflow_list_with_pagination
    description: Test dataflow listing with pagination
    prompt: "List dataflows with pagination support for large workspaces"
    expected_result: "Should return paginated dataflow results with continuation token for next page"

  # Error Handling and Edge Cases
  - name: unauthenticated_requests
    description: Test tool behavior when user is not authenticated
    prompt: "Try to list workspaces without being authenticated first"
    expected_result: "Should return appropriate authentication error and guidance to authenticate first"

  - name: network_error_handling
    description: Test handling of network connectivity issues
    prompt: "Attempt operations when network connectivity to Microsoft Fabric is unavailable"
    expected_result: "Should handle network errors gracefully with informative error messages"

  - name: malformed_parameters
    description: Test handling of malformed or invalid input parameters
    prompt: "Call tools with malformed JSON or invalid parameter formats"
    expected_result: "Should validate input parameters and return clear error messages for invalid inputs"

  # Integration and Workflow Tests
  - name: full_auth_workflow
    description: Test complete authentication workflow
    prompt: "Perform complete authentication flow: authenticate, check status, get token, then sign out"
    expected_result: "Should successfully complete entire authentication lifecycle with appropriate responses at each step"

  - name: workspace_to_dataflow_workflow
    description: Test workflow from workspace discovery to dataflow listing
    prompt: "List workspaces, then list dataflows for the first available workspace"
    expected_result: "Should successfully navigate from workspace discovery to dataflow enumeration with consistent data"

  - name: resource_discovery_workflow
    description: Test comprehensive resource discovery workflow
    prompt: "Discover all available resources: workspaces, connections, gateways, and dataflows"
    expected_result: "Should provide comprehensive view of all Microsoft Fabric resources accessible to the user"

  # Performance and Scalability Tests
  - name: large_result_set_handling
    description: Test handling of large result sets
    prompt: "List resources when user has access to hundreds of workspaces, connections, or gateways"
    expected_result: "Should handle large datasets efficiently with proper pagination and performance"

  - name: concurrent_request_handling
    description: Test handling of multiple simultaneous requests
    prompt: "Make multiple simultaneous requests for different resource types"
    expected_result: "Should handle concurrent requests properly without conflicts or resource issues"
